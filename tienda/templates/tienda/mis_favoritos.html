{% extends 'tienda/base.html' %}

{% block title %}Mis Favoritos{% endblock %}

{% block extra_css %}
<style>
    .favs-container {
        padding: 50px 20px;
        max-width: 1200px;
        margin: 0 auto;
        min-height: 70vh;
    }

    h1 { 
        text-align: center; 
        color: #2c3e50; 
        margin-bottom: 50px; 
        font-weight: 300; 
        text-transform: uppercase; 
        letter-spacing: 2px;
    }

    /* GRID REUTILIZABLE */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 30px;
    }

    /* TARJETA FAVORITO GLASS */
    .fav-card {
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        transition: transform 0.3s ease, opacity 0.3s ease;
        box-shadow: 0 10px 25px rgba(0,0,0,0.03);
    }
    .fav-card:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 15px 35px rgba(0,0,0,0.08);
    }

    /* Botón Eliminar */
    .btn-remove-fav {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.9);
        color: #e74c3c;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        transition: 0.2s;
    }
    .btn-remove-fav:hover { background: #e74c3c; color: white; transform: scale(1.1); }

    .fav-img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        background: #fff;
    }

    .fav-info { padding: 20px; text-align: center; }
    
    .fav-title { 
        margin: 0 0 10px 0; 
        font-size: 1rem; 
        color: #2c3e50; 
        font-weight: 600; 
    }
    
    .fav-price { color: #2c3e50; font-weight: bold; margin-bottom: 15px; }

    .btn-view {
        display: inline-block;
        padding: 8px 20px;
        border: 1px solid #2c3e50;
        color: #2c3e50;
        text-decoration: none;
        border-radius: 20px;
        font-size: 0.8rem;
        transition: 0.3s;
    }
    .btn-view:hover { background: #2c3e50; color: #fff; }

</style>
{% endblock %}

{% block content %}
<div class="favs-container">
    <a href="{% url 'editar_perfil' %}" style="text-decoration: none; color: #95a5a6; margin-bottom: 20px; display: inline-block;">
        <i class="ri-arrow-left-line"></i> Volver a mi perfil
    </a>

    <h1>Mis Deseos ❤️</h1>

    {% if favoritos %}
        <div class="grid">
            {% for fav in favoritos %}
            <div class="fav-card" id="card-{{ fav.producto.id }}">
                
                <button onclick="eliminarFavorito({{ fav.producto.id }})" class="btn-remove-fav" title="Quitar de favoritos">
                    <i class="ri-close-line"></i>
                </button>

                <a href="{% url 'detalle' fav.producto.id %}" style="text-decoration: none;">
                    {% if fav.producto.imagen %}
                        <img src="{{ fav.producto.imagen.url }}" class="fav-img" loading="lazy">
                    {% else %}
                        <div class="fav-img" style="display: flex; align-items: center; justify-content: center; color: #ccc;">Sin Imagen</div>
                    {% endif %}
                </a>
                
                <div class="fav-info">
                    <h3 class="fav-title">{{ fav.producto.nombre }}</h3>
                    <div class="fav-price">${{ fav.producto.precio }}</div>
                    <a href="{% url 'detalle' fav.producto.id %}" class="btn-view">Ver Joya</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; color: #7f8c8d; margin-top: 50px;">
            <i class="ri-heart-pulse-line" style="font-size: 4rem; color: #ecf0f1;"></i>
            <p>Tu lista de deseos está vacía.</p>
            <a href="{% url 'catalogo' %}" class="btn-gold" style="margin-top: 20px;">Enamorarse de algo</a>
        </div>
    {% endif %}
</div>

<script>
    function eliminarFavorito(productoId) {
        // Usamos la misma vista 'toggle' que sirve para agregar/quitar
        fetch(`/favoritos/toggle/${productoId}/`)
            .then(response => response.json())
            .then(data => {
                if (!data.agregado) {
                    // Animación de salida
                    const card = document.getElementById(`card-${productoId}`);
                    card.style.transform = 'scale(0.8)';
                    card.style.opacity = '0';
                    setTimeout(() => card.remove(), 300);
                }
            });
    }
</script>
{% endblock %}